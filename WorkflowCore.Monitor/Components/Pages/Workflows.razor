@page "/workflows"

@inject Services.WorkflowInstanceService WorkflowInstanceService
@inject WorkflowMonitorService WorkflowMonitorService

<PageTitle>Workflows</PageTitle>

<MudText Typo="Typo.h3" GutterBottom="true">Workflows</MudText>

<MudDataGrid Items="@_workflowDefinitions">
    <Columns>
        <PropertyColumn Property="x => x.Id" Title="#" />
        <PropertyColumn Property="x => x.Version" />
        <PropertyColumn Property="x => x.Description" />
        <PropertyColumn Property="x => x.Steps.Count" Title="Steps" />
        <TemplateColumn>
            <CellTemplate>
                <MudStack Row>
                    <MudButton OnClick="() => Start(context.Item)" Variant="Variant.Filled" Color="Color.Secondary">Start</MudButton>
                    <MudIconButton Href="@($"workflows/{context.Item.Id}")" Icon="@Icons.Material.Filled.MoreVert" />
                </MudStack>
            </CellTemplate>
        </TemplateColumn>
    </Columns>
</MudDataGrid>

@code {

    List<WorkflowDefinition>? _workflowDefinitions;

    protected override void OnInitialized()
    {
        _workflowDefinitions = WorkflowMonitorService.GetRegisteredWorkflows().ToList();
    }

    private Task Start(WorkflowDefinition def)
    {
        return WorkflowInstanceService.StartAsync(def.Id, def.Version);
    }
}
